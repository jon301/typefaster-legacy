(function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define(["jquery","underscore","backbone","marionette","js_logger","controllers/timer","models/player_human","models/player_ghost"],function(a,c,d,e,f,g,h,i){"use strict";var j,k;return j=function(a){function c(){return k=c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.entries="",c.prototype.duration=60,c.prototype.initialize=function(a){return this.logger=f.get("GameController"),this.duration=a.duration,this.entries=a.entries,this.humanPlayer=new h({gameController:this}),this.ghostPlayers=new d.Collection,this.timer=new g},c.prototype.startListen=function(){var a=this;return this.listening?void 0:(this.logger.debug("game: bind listen events"),this.listening=!0,this.listenTo(this,"entry:typed",function(b){return a.running||a.start(),a.humanPlayer.typeEntry(b)}),this.listenTo(this,"entry:deleted",function(){return a.humanPlayer.deleteEntry()}),this.listenTo(this,"human:stop",function(){return a.stop()}),this.listenTo(this,"human:reset",function(){return a.stop(),a.startListen()}))},c.prototype.stopListen=function(){return this.logger.debug("game: unbind listen events"),this.listening=!1,this.stopListening()},c.prototype.start=function(){var a=this;return!this.running&&(this.logger.debug("Game started"),this.running=!0,this.humanPlayer.play(),this.ghostPlayers.invoke("play"),this.duration)?(this.timer.start(),this.interval=setInterval(function(){return a.timer.getElapsedTime()>=1e3*a.duration&&a.stop(),a.trigger("human:stats",a.humanPlayer.getStats())},1e3)):void 0},c.prototype.stop=function(){return this.running?(this.logger.debug("Game stopped"),this.running=!1,clearInterval(this.interval),this.stopListen(),this.timer.stop(),this.humanPlayer.stop()):void 0},c.prototype.setEntries=function(a){return this.running?void 0:(a&&(this.entries=a),this.logger.debug("You have "+this.duration+" seconds to type :"+this.entries))},c.prototype.setDuration=function(a){return this.running?void 0:(a&&(this.duration=a),this.logger.debug("You have "+this.duration+" seconds to type :"+this.entries))},c.prototype.addGhost=function(a){return this.running?void 0:this.ghostPlayers.add(new i({entries:this.entries,replayLogs:a,gameController:this}))},c}(e.Controller)})}).call(this);
(function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};define(["jquery","underscore","templates","marionette","punycode"],function(a,c,d,e,f){"use strict";var g,h;return g=function(c){function e(){return h=e.__super__.constructor.apply(this,arguments)}return b(e,c),e.prototype.el="#typezone-view",e.prototype.template=d["typefaster/static/scripts/templates/typezone.ejs"],e.prototype.ui={entries:".entry",textarea:".typezone-text",input:".typezone-input"},e.prototype.events={"keydown .typezone-input":"onKeydown","keypress .typezone-input":"onKeyPress","compositionstart .typezone-input":"onCompositionStart","compositionend .typezone-input":"onCompositionEnd"},e.prototype.debugEvent=function(a){return console.group(a.type),"KeyboardEvent"===a.originalEvent.constructor.name?(console.log("keyCode="+a.keyCode+" ("+String.fromCharCode(a.keyCode)+")"),console.log("charCode="+a.charCode+" ("+String.fromCharCode(a.charCode)+")"),console.log("which="+a.which+" ("+String.fromCharCode(a.which)+")"),console.log("keyIdentifier="+a.originalEvent.keyIdentifier)):"CompositionEvent"===a.originalEvent.constructor.name&&console.log("data="+(a.data||a.originalEvent.data)),console.groupEnd()},e.prototype.onKeydown=function(a){var b;return this.debugEvent(a),this.focused&&void 0!==a.originalEvent&&(b=a.which,8===b)?this.gameController.trigger("entry:deleted"):void 0},e.prototype.onKeyPress=function(a){var b,c;return this.debugEvent(a),this.focused&&void 0!==a.originalEvent&&(c=a.which,b=String.fromCodePoint(c))?(this.gameController.running||this.gameController.start(),this.gameController.trigger("entry:typed",b)):void 0},e.prototype.onCompositionStart=function(a){return this.debugEvent(a),this.ui.entries.filter(".focus").addClass("composition")},e.prototype.onCompositionEnd=function(a){var b;return this.debugEvent(a),this.ui.entries.filter(".focus").removeClass("composition"),this.focused&&void 0!==a.originalEvent&&(b=a.data||a.originalEvent.data)?(this.gameController.running||this.gameController.start(),this.gameController.trigger("entry:typed",b)):void 0},e.prototype.initialize=function(a){return this.entries=a.entries,this.gameController=a.gameController},e.prototype.onRender=function(){var b=this;return this.$el.show(),this.focus(),a("#typezone-container").on("click",a.proxy(this.focus,this)),a(window).resize(function(){return clearTimeout(b.resizingTimeout),b.resizingTimeout=setTimeout(function(){return b.scrollToEntry(a(".current"))},200)}),a(window).focus(function(){return b.gameController.startListen()}),a(window).blur(function(){return b.blur(),b.gameController.stopListen()}),this.listenTo(this.gameController,"entry:is_correct",function(a){var c,d;return c=b.ui.entries.eq(a),d=b.ui.entries.eq(a+1),c.removeClass("current focus").addClass("correct"),d?(d.addClass("current focus"),b.scrollToEntry(d)):void 0}),this.listenTo(this.gameController,"entry:is_incorrect",function(a){var c,d;return c=b.ui.entries.eq(a),d=b.ui.entries.eq(a+1),c.removeClass("current focus").addClass("incorrect"),d?(d.addClass("current focus"),b.scrollToEntry(d)):void 0}),this.listenTo(this.gameController,"entry:is_reset",function(a){var c,d;return c=b.ui.entries.eq(a),b.ui.entries.removeClass("current focus"),c.removeClass("correct incorrect").addClass("current focus"),0!==a?(d=b.ui.entries.eq(a-1),b.scrollToEntry(d)):void 0}),this.listenTo(this.gameController,"human:stop",function(){return b.disable()})},e.prototype.scrollToEntry=function(a){var b=this;return a.length&&0!==a.parent().position().top&&!this.animating?(this.animating=!0,this.ui.textarea.stop(!0).animate({scrollTop:this.ui.textarea.scrollTop()+a.parent().position().top},function(){return b.animating=!1})):void 0},e.prototype.disable=function(){return this.disabled=!0,this.ui.input.prop("disabled",!0),this.blur()},e.prototype.focus=function(b){return this.ui.input.focus(),this.focused||this.disabled||(console.log("focus typezone"),this.focused=!0,this.$(".current").addClass("focus"),a("#typezone-container").addClass("focus"),a("body").on("click",a.proxy(this.blur,this))),b?(b.preventDefault(),b.stopPropagation()):void 0},e.prototype.blur=function(){return this.ui.input.blur(),this.focused?(console.log("blur typezone"),this.focused=!1,this.$(".current").removeClass("focus"),a("#typezone-container").removeClass("focus"),a("body").off("click",a.proxy(this.blur,this))):void 0},e.prototype.serializeData=function(){return{entries:this.entries,punycode:f}},e}(e.ItemView)})}).call(this);